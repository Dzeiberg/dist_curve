---

title: Title

keywords: fastai
sidebar: home_sidebar



nb_path: "05_Dataset.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_Dataset.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">mat73</span>

<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span><span class="p">,</span><span class="n">savemat</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">from</span> <span class="nn">easydict</span> <span class="kn">import</span> <span class="n">EasyDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">dist_curve.transforms</span> <span class="kn">import</span> <span class="n">getOptimalTransform</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">sched_setaffinity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">getFile</span><span class="p">(</span><span class="n">dsPath</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="n">dsPath</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">dsPath</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">getPUDatasetInstance</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># get indices of all positives and negatives</span>
    <span class="n">posIdxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">negIdxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posIdxs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="n">numPos</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numPos</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="c1"># Split Positive data into component and mixture</span>
    <span class="n">numUnlabeledPos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">posIdxs</span><span class="p">)</span> <span class="o">-</span> <span class="n">numPos</span>
    <span class="n">unlabeledPosIdxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">posIdxs</span><span class="p">,</span>
                                     <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">numUnlabeledPos</span><span class="p">)</span>
    <span class="n">posComponentIdxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">posIdxs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">unlabeledPosIdxs</span><span class="p">))</span>
    <span class="n">posInstances</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">posComponentIdxs</span><span class="p">]</span>
    <span class="c1"># Downsample mixture if necessary</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negIdxs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">unlabeledPosIdxs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="n">n0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10000</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">negIdxs</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">negIdxs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">unlabeledPosIdxs</span><span class="p">)))</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">-</span> <span class="n">n0</span>
        <span class="n">unlabeledNegIdxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">negIdxs</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">n0</span><span class="p">)</span>
        <span class="n">unlabeledPosIdxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">unlabeledPosIdxs</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">n1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unlabeledNegIdxs</span> <span class="o">=</span> <span class="n">negIdxs</span>
    <span class="n">unlabeledInstances</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">unlabeledPosIdxs</span><span class="p">,</span> <span class="n">unlabeledNegIdxs</span><span class="p">))]</span>
    
    <span class="n">hiddenLabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">unlabeledPosIdxs</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unlabeledNegIdxs</span><span class="p">)))</span>
    
    <span class="n">pu_instance</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">({</span>
        <span class="s2">&quot;positiveInstances&quot;</span><span class="p">:</span> <span class="n">posInstances</span><span class="p">,</span>
        <span class="s2">&quot;unlabeledInstances&quot;</span><span class="p">:</span> <span class="n">unlabeledInstances</span><span class="p">,</span>
        <span class="s2">&quot;hiddenLabels&quot;</span><span class="p">:</span> <span class="n">hiddenLabels</span><span class="p">,</span>
        <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">hiddenLabels</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">hiddenLabels</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">pu_instance</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">addOptimalTransformToInstance</span><span class="p">(</span><span class="n">inst</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">positiveInstances</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">unlabeledInstances</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="n">u</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="n">probs</span><span class="p">,</span> <span class="n">aucPU</span> <span class="o">=</span> <span class="n">getOptimalTransform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
    <span class="n">posScores</span> <span class="o">=</span> <span class="n">probs</span><span class="p">[:</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">unlabeledScores</span> <span class="o">=</span> <span class="n">probs</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">posScores</span> <span class="o">=</span> <span class="n">posScores</span>
    <span class="n">out</span><span class="o">.</span><span class="n">unlabeledScores</span> <span class="o">=</span> <span class="n">unlabeledScores</span>
    <span class="n">out</span><span class="o">.</span><span class="n">aucPU</span> <span class="o">=</span> <span class="n">aucPU</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s2">&quot;/data/dzeiberg/ClassPriorEstimation/rawDatasets/*.mat&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">),</span><span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">dsname</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;/data/dzeiberg/ClassPriorEstimation/processedDatasets/</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dsname</span><span class="p">)):</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">getFile</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">NInstances</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">for</span> <span class="n">inst_num</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">NInstances</span><span class="p">),</span><span class="n">total</span><span class="o">=</span><span class="n">NInstances</span><span class="p">,</span><span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">getPUDatasetInstance</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addOptimalTransformToInstance</span><span class="p">(</span><span class="n">inst</span><span class="p">))</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/data/dzeiberg/ClassPriorEstimation/processedDatasets/</span><span class="si">{}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dsname</span><span class="p">),</span><span class="s2">&quot;wb&quot;</span><span class="p">))</span>
            <span class="n">savemat</span><span class="p">(</span><span class="s2">&quot;/data/dzeiberg/ClassPriorEstimation/processedDatasets/</span><span class="si">{}</span><span class="s2">.mat&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dsname</span><span class="p">),</span><span class="n">ds</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-25-a6ac638b32c0&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>         <span class="ansi-green-fg">for</span> inst_num <span class="ansi-green-fg">in</span> tqdm<span class="ansi-blue-fg">(</span>range<span class="ansi-blue-fg">(</span>NInstances<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>total<span class="ansi-blue-fg">=</span>NInstances<span class="ansi-blue-fg">,</span>leave<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>             inst <span class="ansi-blue-fg">=</span> getPUDatasetInstance<span class="ansi-blue-fg">(</span>ds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 10</span><span class="ansi-red-fg">             </span>ds<span class="ansi-blue-fg">.</span>instances<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>addOptimalTransformToInstance<span class="ansi-blue-fg">(</span>inst<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>             pickle<span class="ansi-blue-fg">.</span>dump<span class="ansi-blue-fg">(</span>ds<span class="ansi-blue-fg">,</span>open<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;/data/dzeiberg/ClassPriorEstimation/processedDatasets/{}.pkl&#34;</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>dsname<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">&#34;wb&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span>             savemat<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;/data/dzeiberg/ClassPriorEstimation/processedDatasets/{}.mat&#34;</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>dsname<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>ds<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-24-0dac215f2298&gt;</span> in <span class="ansi-cyan-fg">addOptimalTransformToInstance</span><span class="ansi-blue-fg">(inst)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     s = np.concatenate((np.ones(p.shape[0]),
<span class="ansi-green-intense-fg ansi-bold">      6</span>                         np.zeros(u.shape[0])))
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg">     </span>probs<span class="ansi-blue-fg">,</span> aucPU <span class="ansi-blue-fg">=</span> getOptimalTransform<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span>s<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>     posScores <span class="ansi-blue-fg">=</span> probs<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>p<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>     unlabeledScores <span class="ansi-blue-fg">=</span> probs<span class="ansi-blue-fg">[</span>p<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/dist_curve/dist_curve/transforms.py</span> in <span class="ansi-cyan-fg">getOptimalTransform</span><span class="ansi-blue-fg">(X, y)</span>
<span class="ansi-green-intense-fg ansi-bold">     99</span>             scores<span class="ansi-blue-fg">,</span> auc <span class="ansi-blue-fg">=</span> trainKFoldClassifier<span class="ansi-blue-fg">(</span>X<span class="ansi-blue-fg">,</span>y<span class="ansi-blue-fg">,</span>modelFactory<span class="ansi-blue-fg">=</span>model_factory<span class="ansi-blue-fg">,</span>KFoldValue<span class="ansi-blue-fg">=</span>n<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    100</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 101</span><span class="ansi-red-fg">             </span>scores<span class="ansi-blue-fg">,</span> auc <span class="ansi-blue-fg">=</span> trainOOBClassifier<span class="ansi-blue-fg">(</span>X<span class="ansi-blue-fg">,</span>y<span class="ansi-blue-fg">,</span>modelFactory<span class="ansi-blue-fg">=</span>model_factory<span class="ansi-blue-fg">,</span> n_estimators<span class="ansi-blue-fg">=</span>n<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    102</span>         transform_scores<span class="ansi-blue-fg">[</span>model_name<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> scores
<span class="ansi-green-intense-fg ansi-bold">    103</span>         auc_pu<span class="ansi-blue-fg">[</span>model_name<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> auc

<span class="ansi-green-fg">~/dist_curve/dist_curve/transforms.py</span> in <span class="ansi-cyan-fg">trainOOBClassifier</span><span class="ansi-blue-fg">(X, y, modelFactory, n_estimators, n_jobs)</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>     <span class="ansi-red-fg"># z-score normalization is applied to the whole dataset prior to training</span>
<span class="ansi-green-intense-fg ansi-bold">     41</span>     X<span class="ansi-blue-fg">,</span>ss <span class="ansi-blue-fg">=</span> prepFeatures<span class="ansi-blue-fg">(</span>X<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 42</span><span class="ansi-red-fg">     clf = BaggingClassifier(n_jobs=n_jobs,base_estimator=modelFactory(), n_estimators=n_estimators,
</span><span class="ansi-green-intense-fg ansi-bold">     43</span>                             max_samples<span class="ansi-blue-fg">=</span>X<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span>max_features<span class="ansi-blue-fg">=</span>X<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> bootstrap<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     44</span>                             bootstrap_features=False, oob_score=True).fit(X,y)

<span class="ansi-green-fg">~/miniconda3/lib/python3.8/site-packages/sklearn/ensemble/_bagging.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, X, y, sample_weight)</span>
<span class="ansi-green-intense-fg ansi-bold">    241</span>         self <span class="ansi-blue-fg">:</span> object
<span class="ansi-green-intense-fg ansi-bold">    242</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 243</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_fit<span class="ansi-blue-fg">(</span>X<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>max_samples<span class="ansi-blue-fg">,</span> sample_weight<span class="ansi-blue-fg">=</span>sample_weight<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    244</span> 
<span class="ansi-green-intense-fg ansi-bold">    245</span>     <span class="ansi-green-fg">def</span> _parallel_args<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda3/lib/python3.8/site-packages/sklearn/ensemble/_bagging.py</span> in <span class="ansi-cyan-fg">_fit</span><span class="ansi-blue-fg">(self, X, y, max_samples, max_depth, sample_weight)</span>
<span class="ansi-green-intense-fg ansi-bold">    367</span>         self<span class="ansi-blue-fg">.</span>_seeds <span class="ansi-blue-fg">=</span> seeds
<span class="ansi-green-intense-fg ansi-bold">    368</span> 
<span class="ansi-green-fg">--&gt; 369</span><span class="ansi-red-fg">         all_results = Parallel(n_jobs=n_jobs, verbose=self.verbose,
</span><span class="ansi-green-intense-fg ansi-bold">    370</span>                                <span class="ansi-blue-fg">**</span>self<span class="ansi-blue-fg">.</span>_parallel_args<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span>
<span class="ansi-green-intense-fg ansi-bold">    371</span>             delayed(_parallel_build_estimators)(

<span class="ansi-green-fg">~/miniconda3/lib/python3.8/site-packages/joblib/parallel.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, iterable)</span>
<span class="ansi-green-intense-fg ansi-bold">   1059</span> 
<span class="ansi-green-intense-fg ansi-bold">   1060</span>             <span class="ansi-green-fg">with</span> self<span class="ansi-blue-fg">.</span>_backend<span class="ansi-blue-fg">.</span>retrieval_context<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1061</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">.</span>retrieve<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1062</span>             <span class="ansi-red-fg"># Make sure that we get a last message telling us we are done</span>
<span class="ansi-green-intense-fg ansi-bold">   1063</span>             elapsed_time <span class="ansi-blue-fg">=</span> time<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> self<span class="ansi-blue-fg">.</span>_start_time

<span class="ansi-green-fg">~/miniconda3/lib/python3.8/site-packages/joblib/parallel.py</span> in <span class="ansi-cyan-fg">retrieve</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    938</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    939</span>                 <span class="ansi-green-fg">if</span> getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_backend<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;supports_timeout&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 940</span><span class="ansi-red-fg">                     </span>self<span class="ansi-blue-fg">.</span>_output<span class="ansi-blue-fg">.</span>extend<span class="ansi-blue-fg">(</span>job<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>timeout<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    941</span>                 <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    942</span>                     self<span class="ansi-blue-fg">.</span>_output<span class="ansi-blue-fg">.</span>extend<span class="ansi-blue-fg">(</span>job<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/lib/python3.8/site-packages/joblib/_parallel_backends.py</span> in <span class="ansi-cyan-fg">wrap_future_result</span><span class="ansi-blue-fg">(future, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    540</span>         AsyncResults.get from multiprocessing.&#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    541</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 542</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> future<span class="ansi-blue-fg">.</span>result<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">=</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    543</span>         <span class="ansi-green-fg">except</span> CfTimeoutError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    544</span>             <span class="ansi-green-fg">raise</span> TimeoutError <span class="ansi-green-fg">from</span> e

<span class="ansi-green-fg">~/miniconda3/lib/python3.8/concurrent/futures/_base.py</span> in <span class="ansi-cyan-fg">result</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    432</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>__get_result<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    433</span> 
<span class="ansi-green-fg">--&gt; 434</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_condition<span class="ansi-blue-fg">.</span>wait<span class="ansi-blue-fg">(</span>timeout<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    435</span> 
<span class="ansi-green-intense-fg ansi-bold">    436</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_state <span class="ansi-green-fg">in</span> <span class="ansi-blue-fg">[</span>CANCELLED<span class="ansi-blue-fg">,</span> CANCELLED_AND_NOTIFIED<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda3/lib/python3.8/threading.py</span> in <span class="ansi-cyan-fg">wait</span><span class="ansi-blue-fg">(self, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    300</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>    <span class="ansi-red-fg"># restore state no matter what (e.g., KeyboardInterrupt)</span>
<span class="ansi-green-intense-fg ansi-bold">    301</span>             <span class="ansi-green-fg">if</span> timeout <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 302</span><span class="ansi-red-fg">                 </span>waiter<span class="ansi-blue-fg">.</span>acquire<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    303</span>                 gotit <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">    304</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds2</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/data/dzeiberg/ClassPriorEstimation/processedDatasets_partial/abalone.pkl&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds2</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;positiveInstances&#39;, &#39;unlabeledInstances&#39;, &#39;hiddenLabels&#39;, &#39;alpha&#39;, &#39;posScores&#39;, &#39;unlabeledScores&#39;, &#39;aucPU&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

